<UserControl x:Class="Controls.CustomDatePicker"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d" 
             d:DesignHeight="22" d:DesignWidth="200">
    <Grid x:Name="RootGrid">
        <Border x:Name="Border"
              Background="{StaticResource InputBackground}"
              BorderBrush="{StaticResource InputBorder}"
              BorderThickness="1"
              CornerRadius="2"
              Padding="8,6">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBox x:Name="DateTextBox"
                       Grid.Column="0"
                       Background="Transparent"
                       BorderThickness="0"
                       Foreground="{StaticResource InputText}"
                       VerticalContentAlignment="Center"
                       IsReadOnly="True"
                       Cursor="Arrow"
                       Tag="{Binding Tag, RelativeSource={RelativeSource AncestorType=UserControl}}">
                    <TextBox.Style>
                        <Style TargetType="TextBox" BasedOn="{StaticResource TextBoxDark}">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="BorderThickness" Value="0"/>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="TextBox">
                                        <Border Background="Transparent"
                                              BorderThickness="0">
                                            <Grid>
                                                <ScrollViewer x:Name="PART_ContentHost"
                                                            Focusable="False"
                                                            HorizontalScrollBarVisibility="Hidden"
                                                            VerticalScrollBarVisibility="Hidden"/>
                                                <TextBlock x:Name="PlaceholderText"
                                                         Text="{TemplateBinding Tag}"
                                                         Foreground="{StaticResource InputPlaceholder}"
                                                         VerticalAlignment="Center"
                                                         IsHitTestVisible="False"
                                                         Visibility="Collapsed"
                                                         Margin="0,0,0,0"/>
                                            </Grid>
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="Text" Value="">
                                                <Setter TargetName="PlaceholderText" Property="Visibility" Value="Visible"/>
                                            </Trigger>
                                            <Trigger Property="IsFocused" Value="True">
                                                <Setter TargetName="PlaceholderText" Property="Visibility" Value="Collapsed"/>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </TextBox.Style>
                </TextBox>
                <Button x:Name="CalendarButton"
                      Grid.Column="1"
                      Width="20"
                      Height="20"
                      Background="Transparent"
                      BorderThickness="0"
                      Cursor="Hand"
                      Click="CalendarButton_Click"
                      Margin="4,0,0,0"
                      VerticalAlignment="Center">
                    <Button.Template>
                        <ControlTemplate TargetType="Button">
                            <Border Background="Transparent"
                                  BorderThickness="0">
                                <Path Data="M 2,2 L 2,6 L 18,6 L 18,2 L 2,2 M 2,6 L 2,18 L 18,18 L 18,6 M 6,2 L 6,6 M 10,2 L 10,6 M 14,2 L 14,6 M 2,10 L 18,10 M 2,14 L 18,14 M 2,18 L 18,18"
                                      Fill="{StaticResource TextPrimary}"
                                      HorizontalAlignment="Center"
                                      VerticalAlignment="Center"
                                      Stretch="Uniform"
                                      Width="14"
                                      Height="14"/>
                            </Border>
                        </ControlTemplate>
                    </Button.Template>
                </Button>
            </Grid>
        </Border>
        <Popup x:Name="CalendarPopup"
             Placement="Bottom"
             PlacementTarget="{Binding ElementName=Border}"
             AllowsTransparency="True"
             Focusable="False"
             PopupAnimation="Slide"
             StaysOpen="False"
             Opened="CalendarPopup_Opened"
             Closed="CalendarPopup_Closed">
            <Border Background="{StaticResource BackgroundCard}"
                  BorderBrush="{StaticResource BorderColor}"
                  BorderThickness="1"
                  CornerRadius="2"
                  Padding="4">
                <Calendar x:Name="DateCalendar"/>
            </Border>
        </Popup>
    </Grid>
</UserControl>

